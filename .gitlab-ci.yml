variables:
    REPO: trasioteam/taref-dev
    TA_REF_DOCS_DIR: /home/user/ta-ref/docs
    TA_REF_PDF: ta-ref.pdf

before_script:
    - docker login -u ${DOCKERHUB_USER} -p ${DOCKERHUB_PASSWD}

taref-dev-doxygen:
    variables:
        BRANCH: teep-master
    tags:
        - shell117
    script:
        - docker build --build-arg BRANCH=${BRANCH} --build-arg DEBUG_DATE=$(date +%s) --build-arg CI_JOB_TOKEN=${CI_JOB_TOKEN} --rm -t ${REPO}:doxygen ./doxygen/teep-master
        - docker push ${REPO}:doxygen
        - docker run --name $CI_PIPELINE_ID -d ${REPO}:doxygen
        - docker wait $CI_PIPELINE_ID
        - docker cp $CI_PIPELINE_ID:${TA_REF_DOCS_DIR}/${TA_REF_PDF} $CI_PROJECT_DIR/${TA_REF_PDF}
    artifacts:
        paths:
            - $CI_PROJECT_DIR/${TA_REF_PDF}
        expire_in: 1 week

taref-dev-sgx:
    variables:
        BRANCH: teep-master
    tags:
        - shell115
    script:
        - docker build --build-arg BRANCH=${BRANCH} --build-arg DEBUG_DATE=$(date +%s) --build-arg CI_JOB_TOKEN=${CI_JOB_TOKEN} --rm -t ${REPO}:sgx ./sgx/teep-master
        - docker push ${REPO}:sgx

taref-dev-optee:
    variables:
        BRANCH: teep-master
    tags:
        - shell117
    script:
        - docker build --build-arg BRANCH=${BRANCH} --build-arg DEBUG_DATE=$(date +%s) --build-arg CI_JOB_TOKEN=${CI_JOB_TOKEN} --rm -t ${REPO}:optee ./optee/teep-master
        - docker push ${REPO}:optee

taref-dev-keystone:
    variables:
        BRANCH: teep-master
    tags:
        - shell121
    script:
        - docker build --build-arg BRANCH=${BRANCH} --build-arg DEBUG_DATE=$(date +%s) --build-arg CI_JOB_TOKEN=${CI_JOB_TOKEN} --rm -t ${REPO}:keystone ./keystone/teep-master
        - docker push ${REPO}:keystone
